# L10N管理アプリケーション - 要件定義書

## 1. プロジェクト概要

### 1.1 目的
GitHubリポジトリでメンテナンスされている多言語Webサイトのローカライゼーション(L10N)状況を可視化し、翻訳の進捗を追跡・管理するアプリケーションを開発する。

### 1.2 対象サイト
- 初期対象: [Cloud-Native-Platform-Engineering/cnpe-community](https://github.com/Cloud-Native-Platform-Engineering/cnpe-community)
- Hugo静的サイトジェネレーター利用
- 現在7言語をサポート: en(英語), ja(日本語), ko(韓国語), zh(中国語), de(ドイツ語), es(スペイン語), fr(フランス語)

### 1.3 現状分析
```
言語別コンテンツファイル数 (2026年2月時点):
- en (英語/ベース言語): 41ファイル (100%)
- ja (日本語): 14ファイル (34.1%)
- ko (韓国語): 9ファイル (22.0%)
- zh (中国語): 9ファイル (22.0%)
- de (ドイツ語): 1ファイル (2.4%)
- es (スペイン語): 2ファイル (4.9%)
- fr (フランス語): 1ファイル (2.4%)
```

---

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 サイト登録・管理
- **複数サイト管理**
  - 異なるGitHubリポジトリのサイトを複数登録可能
  - サイトごとに以下の情報を管理:
    - サイト名
    - リポジトリURL (owner/repo形式)
    - ブランチ名 (デフォルト: main)
    - コンテンツディレクトリパス (例: `website/content`)
    - i18nディレクトリパス (例: `website/i18n`)
    - 設定ファイルパス (例: `website/config.toml`)

#### 2.1.2 ベース言語・対象言語設定
- **ベース言語の指定**
  - 翻訳元となる言語を設定 (例: en)

- **対象言語の管理**
  - サイトごとにサポート言語を登録
  - 言語コード、言語名(ネイティブ表記)、表示優先度を設定

#### 2.1.3 L10N状況の自動分析
- **コンテンツファイル分析**
  - ベース言語のMarkdownファイル一覧を取得
  - 各対象言語のファイル存在チェック
  - ファイル単位の翻訳完了/未完了ステータス
  - ファイルサイズ・最終更新日時の比較
  - ディレクトリ構造の対応状況

- **i18n翻訳ファイル分析**
  - i18nファイル(TOML/YAML/JSON)内の翻訳キー抽出
  - ベース言語との差分検出 (未翻訳キー、余剰キー)
  - 翻訳文字列の長さ比較

- **設定ファイル分析**
  - Hugo config.toml等から言語設定を自動抽出
  - 言語ごとのメタデータ(title, description等)の翻訳状況

#### 2.1.4 進捗レポート・ダッシュボード
- **サマリービュー**
  - 言語別の翻訳完了率 (%)
  - 全体の翻訳進捗状況
  - 最近の更新アクティビティ

- **詳細ビュー**
  - 言語別の詳細ステータス
    - 翻訳済みファイル数/総ファイル数
    - 未翻訳ファイルリスト
    - i18n未翻訳キーリスト
  - ファイル・ディレクトリ単位の翻訳状況ツリー表示
  - 翻訳の優先度設定・表示

#### 2.1.5 GitHubとの連携
- **GitHub API統合**
  - リポジトリからのデータ取得 (GitHub Contents API)
  - ファイルの最終更新日時・コミット情報取得
  - 認証トークン管理 (Personal Access Token)

- **定期的な自動更新**
  - スケジュール設定 (例: 1日1回)
  - 手動更新トリガー
  - 更新履歴の記録

### 2.2 拡張機能

#### 2.2.1 通知機能
- 翻訳が古くなったファイルの検出 (ベース言語が更新されているが翻訳版が未更新)
- 新規ファイル追加の検出
- メール/Slack通知 (オプション)

#### 2.2.2 エクスポート機能
- 翻訳状況レポートのエクスポート
  - CSV形式
  - JSON形式
  - Markdown形式

#### 2.2.3 翻訳タスク管理
- 未翻訳ファイルのタスク化
- 担当者アサイン (オプション)
- ステータス管理 (未着手/進行中/完了)

---

## 3. 非機能要件

### 3.1 パフォーマンス
- 1サイトあたりの分析処理時間: 30秒以内
- 複数サイト(最大10サイト)の同時管理に対応
- GitHub API Rate Limitへの対応 (適切なキャッシング)

### 3.2 スケーラビリティ
- サイト数の増加に対応可能な設計
- 将来的なフレームワーク対応 (Hugo以外: Jekyll, Docusaurus, VuePress等)

### 3.3 データ管理
- サイト設定、分析結果の永続化
- 履歴データの保持 (翻訳進捗の時系列変化を追跡)

### 3.4 セキュリティ
- GitHub Personal Access Tokenの安全な保管 (暗号化)
- 環境変数またはシークレット管理サービスの利用

### 3.5 ユーザビリティ
- 直感的なUI/UX
- レスポンシブデザイン (デスクトップ/モバイル対応)
- 多言語UI (日本語/英語)

---

## 4. 技術スタック (推奨)

### 4.1 フロントエンド
- **フレームワーク**: React / Next.js または Vue.js / Nuxt.js
- **UIライブラリ**: Tailwind CSS, shadcn/ui, Material-UI等
- **状態管理**: Context API / Redux / Zustand
- **データ可視化**: Recharts / Chart.js / D3.js

### 4.2 バックエンド
- **ランタイム**: Node.js / TypeScript
- **フレームワーク**: Express.js / Fastify / Hono
- **ORM/データベース**:
  - SQLite (ローカル環境)
  - PostgreSQL (本番環境)
  - Prisma / Drizzle ORM
- **GitHub連携**: Octokit (GitHub REST API SDK)

### 4.3 インフラ
- **開発環境**: Docker / Docker Compose
- **デプロイ**: Vercel / Railway / Fly.io / AWS
- **CI/CD**: GitHub Actions

### 4.4 その他
- **認証**: JWT / NextAuth.js (将来的にマルチユーザー対応する場合)
- **タスクスケジューラ**: node-cron / BullMQ
- **キャッシュ**: Redis (オプション)

---

## 5. システムアーキテクチャ (概要)

### 5.1 アプリケーション構成
```
┌─────────────────────────────────────────┐
│         フロントエンド (Web UI)          │
│   - ダッシュボード                       │
│   - サイト管理画面                       │
│   - L10N進捗レポート                     │
└─────────────────┬───────────────────────┘
                  │ REST API / GraphQL
┌─────────────────▼───────────────────────┐
│         バックエンド (API Server)         │
│   - サイト管理API                        │
│   - L10N分析エンジン                      │
│   - GitHub連携サービス                   │
│   - スケジューラ                          │
└─────────────────┬───────────────────────┘
                  │
      ┌───────────┼───────────┐
      │           │           │
┌─────▼─────┐ ┌──▼──────┐ ┌─▼────────────┐
│ Database  │ │  Cache  │ │ GitHub API   │
│ (SQLite/  │ │ (Redis) │ │              │
│ PostgreSQL)│ │         │ │              │
└───────────┘ └─────────┘ └──────────────┘
```

### 5.2 データモデル (主要エンティティ)
- **Site** (サイト情報)
  - id, name, repo_url, branch, content_path, i18n_path, config_path, base_language

- **Language** (言語情報)
  - id, site_id, code, name, weight

- **ContentFile** (コンテンツファイル)
  - id, site_id, language_code, file_path, file_size, last_updated, sha

- **I18nKey** (i18n翻訳キー)
  - id, site_id, language_code, key, value, file_path

- **AnalysisResult** (分析結果)
  - id, site_id, language_code, total_files, translated_files, completion_rate, analyzed_at

---

## 6. 開発フェーズ

### Phase 1: MVP (Minimum Viable Product)
- 単一サイトの登録・管理
- コンテンツファイルの翻訳状況分析
- シンプルなダッシュボード表示
- 手動更新機能

### Phase 2: 機能拡張
- 複数サイト対応
- i18n翻訳ファイル分析
- 自動更新スケジューラ
- エクスポート機能

### Phase 3: 高度な機能
- 翻訳タスク管理
- 通知機能
- ユーザー認証・マルチユーザー対応
- 詳細な翻訳履歴・差分表示

---

## 7. 成功指標 (KPI)

- L10N状況の可視化による翻訳漏れの削減
- 翻訳進捗の定量的な把握
- 複数サイトの一元管理による運用効率化
- コミュニティ貢献者への翻訳タスクの明確化

---

## 8. 制約・前提条件

### 8.1 対象リポジトリの前提
- GitHubでホストされている公開/プライベートリポジトリ
- Hugoベースのサイト (Phase 1)
- 言語ごとにディレクトリが分かれている構造 (`content/{lang}/`)

### 8.2 GitHub API制限
- 未認証: 60リクエスト/時間
- 認証済み: 5000リクエスト/時間
- 適切なキャッシング戦略が必要

### 8.3 サポート範囲
- 静的サイトジェネレーター (Hugo, Jekyll等) のみ
- 動的CMS (WordPress等) は対象外

---

## 9. 将来的な拡張可能性

- **他のSSGフレームワーク対応**: Docusaurus, VuePress, Gatsby等
- **GitLab/Bitbucket対応**: GitHub以外のGitホスティングサービス
- **機械翻訳連携**: DeepL API / Google Translate APIとの統合
- **翻訳メモリ機能**: 過去の翻訳を活用した効率化
- **翻訳品質スコアリング**: 文字数バランス、用語統一チェック等
- **コミュニティ貢献者向けUI**: 翻訳者が直接タスクを選んで作業できる仕組み

---

## 10. 参考情報

### 10.1 対象リポジトリ構造
```
cnpe-community/
├── website/
│   ├── content/
│   │   ├── en/  (41 files) ← ベース言語
│   │   ├── ja/  (14 files)
│   │   ├── ko/  (9 files)
│   │   ├── zh/  (9 files)
│   │   ├── de/  (1 file)
│   │   ├── es/  (2 files)
│   │   └── fr/  (1 file)
│   ├── i18n/
│   │   ├── en.toml
│   │   ├── ja.toml
│   │   └── ... (各言語の翻訳ファイル)
│   └── config.toml  (Hugo設定ファイル)
```

### 10.2 GitHub API エンドポイント例
- リポジトリコンテンツ取得: `GET /repos/{owner}/{repo}/contents/{path}`
- コミット情報取得: `GET /repos/{owner}/{repo}/commits?path={file_path}`
- ツリー取得: `GET /repos/{owner}/{repo}/git/trees/{tree_sha}?recursive=1`

---

## 11. 質問・確認事項

以下の点について、プロジェクト開始前に確認が必要です:

1. **優先する機能**: Phase 1のMVPで最優先したい機能は何か?
2. **技術スタック**: フロントエンド/バックエンドの技術選定に希望はあるか?
3. **デプロイ環境**: ローカル環境のみか、クラウドデプロイも想定しているか?
4. **ユーザー層**: 個人利用か、チーム/組織での利用を想定しているか?
5. **UI言語**: 日本語のみか、英語も必要か?
6. **GitHub認証**: Personal Access Tokenの管理方法 (環境変数、UI入力等)

---

**文書バージョン**: 1.0
**作成日**: 2026年2月16日
**最終更新日**: 2026年2月16日
